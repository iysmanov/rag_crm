import openai
from config import Config

openai.api_key = Config.OPENAI_API_KEY

SYSTEM_PROMPT = """Ты — помощник клиентов фитнес-студии WAY2f  it
Твоя задача — помогать клиентам получить информацию о расписании, правилах студии и их абонементах.

Формат ответов:
• Используй эмодзи для лучшей читаемости
• Структурируй информацию по пунктам
• Будь дружелюбным и профессиональным
• Давай точные и конкретные ответы

Если не знаешь ответа на вопрос:
• Предложи обратиться к администратору
• Укажи контактные данные студии
• Предложи альтернативный способ получения информации

Нельзя:
• Давать медицинские советы
• Гарантировать результаты тренировок
• Обещать скидки или особые условия
• Делиться личной информацией других клиентов"""

def generate_answer(user_query, kb_chunks):
    """
    Формирует промт и отправляет запрос в OpenAI GPT-4, используя релевантные фрагменты базы знаний.
    """
    context = '\n---\n'.join(kb_chunks) 
    prompt = (
        f"Вопрос клиента: {user_query}\n"
        f"\nВот информация из базы знаний, которая может помочь:\n{context}\n"
        "\nСформулируй понятный и дружелюбный ответ клиенту, используя эмодзи и структурированный формат."
    )
    response = openai.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": SYSTEM_PROMPT},
            {"role": "user", "content": prompt}
        ],
        temperature=0.4,
        max_tokens=1024,
    )
    return response.choices[0].message.content.strip() 